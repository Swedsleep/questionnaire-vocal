<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Questionnaire DSM-5 (Vocal)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
    #main, #questionnaire, #summary { background: #fff; padding: 2em; border-radius: 1em; box-shadow: 0 2px 10px #0056cc22; max-width: 650px; margin: 3em auto 2em; }
    h1, h2 { color: #0056cc; font-weight: bold; }
    #status { color: #c00; font-weight: bold; margin-bottom: 1em; }
    #answersList { text-align: left; }
    input[type="text"] { padding: 0.5em; font-size: 1.1em; border-radius: 5px; border: 1px solid #bbb; margin: 0.7em 1em 0.7em 0; width: 7em; }
    button { background: #0056cc; color: #fff; border: none; border-radius: 1em; padding: 0.7em 1.7em; font-size: 1.1em; margin: 0.7em 0.7em 0 0; cursor: pointer; }
    button:disabled { background: #aaa; }
    #globalComment { width: 98%; min-height: 40px; font-size: 1.05em; padding: 0.5em; border-radius: 0.6em; border: 1px solid #bbb; margin-top: 0.7em; }
    #pauseBtn, #resumeBtn { background: #fb8c00; color: #fff; }
    @media (max-width: 700px) {
      #main, #questionnaire, #summary { padding: 0.7em; }
      button { padding: 0.5em 1em; font-size: 1em; }
    }
    .partTitle { font-size:1.22em; font-weight: bold; color:#337; margin-top:1.7em; }
  </style>
</head>
<body>
  <div id="main">
    <h1>Questionnaire DSM-5 (Vocal)</h1>
    <div id="status"></div>
    <div id="intro">
      <p id="introText"></p>
      <p>
        <label for="codeInput"><b>Entrez un code de 4 chiffres (au choix) :</b></label><br>
        <input type="text" id="codeInput" maxlength="4" pattern="[0-9]{4}" autocomplete="off" />
      </p>
      <button id="startBtn">Commencer</button>
    </div>
  </div>
  <div id="questionnaire" style="display:none;">
    <div id="partLabel" style="font-size:1.13em;color:#0056cc;margin-bottom:1em;"></div>
    <p id="question"></p>
    <button id="speakBtn">Répondre à voix haute</button>
    <p id="response"></p>
    <button id="nextBtn" style="display:none;">Question suivante</button>
    <button id="pauseBtn">Pause</button>
    <button id="resumeBtn" style="display:none;">Reprendre</button>
  </div>
  <div id="summary" style="display:none;">
    <h2>Merci !</h2>
    <p>Voici vos réponses :</p>
    <ul id="answersList"></ul>
    <label for="globalComment">Commentaire global (optionnel) :</label>
    <textarea id="globalComment" placeholder="Vous pouvez ici ajouter tout commentaire libre..."></textarea>
    <br>
    <button id="copyBtn">Copier les réponses</button>
    <button id="pdfBtn">Exporter en PDF</button>
    <p style="font-size:0.97em; color:#666; margin-top:2em;">Pour transmettre à votre professionnel, copiez vos réponses ou exportez en PDF puis envoyez-les par mail.</p>
  </div>
  <script>
  
    // --- Introduction ---
const introTexte = "Je vais vous poser plusieurs questions portant sur les dernières semaines. Commencez par entrer un code de 4 chiffres que vous choisissez à votre guise. Ces questions sont groupées en 23 sections : prenez votre temps, répondez calmement, vous pouvez commenter et faire une pause. S'il y a erreur pressez le bouton "voix haute". À la fin, un commentaire global est possible. Vous pouvez passer à la question suivante en disant 'suivant' ou en appuyant sur Entrée. À la fin du questionnaire, vous pourrez copier vos réponses ou les enregistrer en PDF grâce aux boutons prévus à cet effet.";

// --- Titres des parties et découpe ---
const partTitles = ["Première partie : Symptômes principaux",
"Deuxième partie : Questions additionnelles"
];
// La question 37 commence la 2e partie (ajuste selon tes sections si besoin)
const partBreaks = [37];

// --- QUESTIONS (~53, SECTIONS 1 À 23) ---
 const questions = [
  // Section 1
  { section: 1, text: "Veuillez indiquer votre code d’identification." },
  { text: "Quel est votre âge ?" },
  { text: "Quel est votre sexe ?" },
  { text: "Quel est votre profession ?" },

  // Section 2
  { section: 2, text: "Y a-t-il des antécédents médicaux connus ? Si oui, veuillez préciser." },
  { text: "Des traitements médicamenteux sont-ils actuellement suivis ? Si oui, veuillez indiquer lesquels, y compris les médicaments sans ordonnance et les compléments alimentaires." },

  // Section 3
  { section: 3, text: "Ressentez-vous de la nervosité, de l’anxiété ou une tension excessive ?" },
  { text: "Avez-vous tendance à vous inquiéter excessivement pour diverses choses, ou à ne pas pouvoir contrôler vos inquiétudes ?" },
  { text: "Avez-vous des difficultés à vous concentrer, par exemple en lisant ou en regardant la télévision ?" },
  { text: "Vous sentez-vous agité(e), avez-vous du mal à rester assis(e) tranquillement ?" },
  { text: "Observez-vous des troubles de l’appétit, tels qu’une perte ou une augmentation de l’appétit ?" },
  { text: "Ressentez-vous un sentiment d’échec ou d’avoir déçu vous-même ou votre entourage ?" },

  // Section 4
  { section: 4, text: "Manquez-vous d’intérêt ou de plaisir à faire des choses qui vous plaisaient auparavant ?" },
  { text: "Ressentez-vous une humeur dépressive, une tristesse ou un sentiment de désespoir ?" },
  { text: "Vous sentez-vous fatigué(e) ou avez-vous un manque d’énergie ?" },

  // Section 5
  { section: 5, text: "Répétez-vous certains gestes, comme vous laver les mains, compter, vérifier ou organiser des objets ? (Si non, passez à la section suivante)" },
  { text: "Ces comportements sont-ils effectués en réponse à une pensée obsessionnelle ou une peur ?" },
  { text: "Ces pensées ou comportements occupent-ils plus d’une heure par jour ou perturbent-ils significativement votre vie quotidienne ?" },

  // Section 6
  { section: 6, text: "Êtes-vous facilement irritable ou en colère ?" },
  { text: "Estimez-vous que vos accès de colère sont disproportionnés par rapport à la situation ?" },

  // Section 7
  { section: 7, text: "Traversez-vous des périodes où vous vous sentez particulièrement énergique, euphorique ou surexcité(e) ?" },
  { text: "Lors de ces périodes, avez-vous tendance à entreprendre des activités qui pourraient avoir des conséquences négatives ?" },

  // Section 8
  { section: 8, text: "Vous arrive-t-il de vous sentir détaché(e) de vous-même ou de votre environnement ?" },
  { text: "Avez-vous déjà ressenti une impression d’irréalité à propos de votre environnement ?" },

  // Section 9
  { section: 9, text: "Rencontrez-vous des difficultés de mémoire, comme oublier des informations ou perdre le sens de l’orientation (par exemple, retrouver votre chemin) ?" },

  // Section 10
  { section: 10, text: "Dans quelle mesure ces difficultés ont-elles affecté votre capacité à travailler, à vous occuper de votre domicile ou à entretenir des relations avec autrui ?" },
  { text: "À quel point estimez-vous que votre situation de vie actuelle et vos relations sociales vous apportent du soutien ?" },

  // Section 11
  { section: 11, text: "Utilisez-vous du tabac, de l’alcool, des drogues ou de la caféine ? Si oui, veuillez indiquer la fréquence et la quantité." },

  // Section 12
  { section: 12, text: "Ressentez-vous des douleurs chroniques ou un inconfort physique ? Si oui, merci de préciser." },
  { text: "Y a-t-il d’autres symptômes physiques que vous avez remarqués et qui vous préoccupent ?" },
  { text: "Comment évalueriez-vous votre état de santé physique global (mauvais, passable, bon, très bon, excellent) ?" },

  // Section 13
  { section: 13, text: "Avez-vous eu des pensées selon lesquelles il vaudrait mieux être mort(e) ou vous blesser d’une quelconque manière ?" },

  // Section 14
  { section: 14, text: "Comment évalueriez-vous la qualité générale de votre sommeil ?" },
  { text: "Éprouvez-vous des difficultés à vous endormir ou à rester endormi(e) durant la nuit ?" },
  { text: "Vous réveillez-vous le matin en vous sentant reposé(e) ou encore fatigué(e) ?" },
  { text: "Avez-vous des troubles du sommeil, tels que des cauchemars, du somnambulisme ou des réveils fréquents ?" },
  { text: "Utilisez-vous des médicaments ou des substances pour faciliter le sommeil ?" },
  { text: "Des changements de mode de vie ou des événements récents ont-ils modifié votre rythme de sommeil ?" },

  // Section 15
  { section: 15, text: "À quelle fréquence pratiquez-vous une activité physique ou de l’exercice ?" },

  // Section 16
  { section: 16, text: "Un diagnostic de trouble psychique a-t-il déjà été posé auparavant ?" },
  { text: "Un traitement pour des difficultés psychiques a-t-il déjà été suivi (thérapie, conseil, médication) ? Si oui, merci de préciser." },

  // Section 17
  { section: 17, text: "Y a-t-il un sujet spécifique que vous souhaitez aborder lors de la consultation ?" },
  { text: "Quels sont vos objectifs ou attentes en consultant actuellement ?" },

  // Section 18
  { section: 18, text: "Avez-vous perçu des voix que les autres ne semblent pas entendre ?" },
  { text: "Avez-vous eu des croyances ou des idées que d’autres personnes considèrent comme étranges ou inhabituelles ?" },

  // Section 19
  { section: 19, text: "Vous arrive-t-il de vous inquiéter de façon excessive pour votre poids ou votre apparence corporelle ?" },
  { text: "Avez-vous eu des épisodes de restriction alimentaire importante, de vomissements volontaires, ou de prises alimentaires excessives et incontrôlables ?" },

  // Section 20
  { section: 20, text: "Avez-vous constaté une baisse notable de votre intérêt ou de votre satisfaction concernant votre sexualité ?" },

  // Section 21
  { section: 21, text: "Avez-vous été exposé(e) à un événement traumatique qui continue à vous perturber (cauchemars, flashbacks, évitement) ?" },
  { text: "Présentez-vous des réactions de stress importantes en lien avec des souvenirs douloureux ?" },

  // Section 22
  { section: 22, text: "Rencontrez-vous souvent des difficultés à rester concentré(e), à terminer ce que vous commencez, ou à rester en place ?" },
  { text: "Êtes-vous fréquemment distrait(e) ou ressentez-vous une agitation intérieure ou physique inhabituelle ?" },

  // Section 23
  { section: 23, text: "Avez-vous été exposé(e) à des situations de violence ou de maltraitance ? Si oui, souhaitez-vous en parler ?" }
];

// --- Variables ---
let responses = [];
let current = 0;
let codePerso = "";
let isPaused = false;

// --- DOM Elements ---
const mainDiv = document.getElementById("main");
const introText = document.getElementById("introText");
const codeInput = document.getElementById("codeInput");
const startBtn = document.getElementById("startBtn");
const questionnaireDiv = document.getElementById("questionnaire");
const partLabel = document.getElementById("partLabel");
const questionEl = document.getElementById("question");
const speakBtn = document.getElementById("speakBtn");
const responseEl = document.getElementById("response");
const nextBtn = document.getElementById("nextBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resumeBtn = document.getElementById("resumeBtn");
const summaryDiv = document.getElementById("summary");
const answersList = document.getElementById("answersList");
const copyBtn = document.getElementById("copyBtn");
const pdfBtn = document.getElementById("pdfBtn");
const statusDiv = document.getElementById("status");
const commentGlobal = document.getElementById("globalComment");

introText.textContent = introTexte;

function speak(txt) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(txt);
  utter.lang = "fr-FR";
  window.speechSynthesis.speak(utter);
}

 function askQuestion(idx) {
  // Afficher le titre de la partie selon le numéro de la question
  if (idx === 0) {
    partLabel.textContent = partTitles[0];
  } else if (partBreaks.includes(idx)) {
    partLabel.textContent = partTitles[1];
  }

  // Affichage conditionnel de "Section X :"
  if (questions[idx].section !== undefined) {
    questionEl.textContent = "Section " + questions[idx].section + " : " + questions[idx].text;
  } else {
    questionEl.textContent = questions[idx].text;
  }

  responseEl.textContent = "";
  nextBtn.style.display = "none"; // on masque les boutons manuels

  // Lecture à voix haute PUIS micro (reconnaissance vocale)
  const utter = new SpeechSynthesisUtterance(questions[idx].text);
  utter.lang = "fr-FR";
  utter.onend = function() {
    if (questionnaireDiv.style.display === "block" && !isPaused) {
      startRecognition();
    }
  };
  window.speechSynthesis.speak(utter);
}
  
  
  
  
  
  
  
  
  
  
  
  // Afficher le titre de la partie selon le numéro de la question
  if (idx === 0) {
    partLabel.textContent = partTitles[0];
  } else if (partBreaks.includes(idx)) {
    partLabel.textContent = partTitles[1];
  }
  questionEl.textContent = "Section " + questions[idx].section + " : " + questions[idx].text;
  responseEl.textContent = "";
  nextBtn.style.display = "none"; //on masque les boutons manuels
  // Lecture à voix haute PUIS micro (reconnaissance vocale)
  const utter = new SpeechSynthesisUtterance(questions[idx].text);
  utter.lang = "fr-FR";
  utter.onend = function() {
    // Quand la lecture est finie on démarre le micro sans action
    if (questionnaireDiv.style.display === "block" && !isPaused) {
      startRecognition();
    }
  };
  window.speechSynthesis.speak(utter);
}

function startRecognition() {
  if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
    statusDiv.textContent = "Reconnaissance vocale non supportée sur ce navigateur ! (utilisez Chrome ou Edge)";
    return;
  }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "fr-FR";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();
  responseEl.textContent = "Écoute en cours...";
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript.trim().toLowerCase();
    responseEl.textContent = transcript;

    // Analyse si la personne dit "suivant", "question suivante", "passer" ou reste silencieuse
    if (
      transcript.includes("suivant") ||
      transcript.includes("question suivante") ||
      transcript.includes("passer") ||
      transcript === "" // silence = on saute
    ) {
      responses[current] = ""; // réponse vide = question sautée
    } else {
      responses[current] = transcript;
    }
    // Passage à la question suivante automatiquement
    setTimeout(() => {
      current++;
      if (current < questions.length) {
        askQuestion(current);
      } else {
        showSummary();
      }
    }, 700); // court délai pour lisibilité

  };
  recognition.onerror = function(event) {
    responseEl.textContent = "Erreur : " + event.error;
  };
}

startBtn.onclick = function() {
  const code = codeInput.value.trim();
  if (!/^\d{4}$/.test(code)) {
    statusDiv.textContent = "Merci de saisir un code de 4 chiffres.";
    return;
  }
  const utter = new SpeechSynthesisUtterance(introTexte);
  utter.lang = "fr-FR";
  utter.onend = function() {
    codePerso = code;
    mainDiv.style.display = "none";
    questionnaireDiv.style.display = "block";
    current = 0;
    responses = [];
    isPaused = false;
    resumeBtn.style.display = "none";
    pauseBtn.style.display = "inline";
    askQuestion(current);
  };
  window.speechSynthesis.speak(utter);
};

speakBtn.onclick = function() { if(!isPaused) startRecognition(); };
nextBtn.onclick = function() {
  if (isPaused) return;
  current++;
  if (current < questions.length) {
    askQuestion(current);
  } else {
    showSummary();
  }
};

pauseBtn.onclick = function() {
  isPaused = true;
  questionnaireDiv.style.opacity = 0.3;
  pauseBtn.style.display = "none";
  resumeBtn.style.display = "inline";
  speak("Pause activée. Dites 'reprendre' pour continuer.");
};
resumeBtn.onclick = function() {
  isPaused = false;
  questionnaireDiv.style.opacity = 1;
  pauseBtn.style.display = "inline";
  resumeBtn.style.display = "none";
  speak("Reprise du questionnaire.");
};

document.addEventListener("keydown", function(e){
  if (questionnaireDiv.style.display === "block" && !isPaused && e.key === "Enter" && nextBtn.style.display !== "none") {
    nextBtn.click();
  }
});

function showSummary() {
  questionnaireDiv.style.display = "none";
  summaryDiv.style.display = "block";
  answersList.innerHTML = "";
  questions.forEach((q, i) => {
    const li = document.createElement("li");
    li.textContent = "Section " + q.section + " — " + q.text + " : " + (responses[i] || "");
    answersList.appendChild(li);
  });
}

copyBtn.onclick = function() {
  const txt = "Code : " + codePerso + "\n"
    + questions.map((q, i) => "Section " + q.section + " — " + q.text + " : " + (responses[i] || "")).join("\n")
    + "\nCommentaire global : " + commentGlobal.value;
  navigator.clipboard.writeText(txt);
  alert("Réponses copiées !");
};

pdfBtn.onclick = function() {
  window.print();
};
  </script>
</body>
</html>
