<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Questionnaire DSM-5 (Vocal)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
    #main, #questionnaire, #summary { background: #fff; padding: 2em; border-radius: 1em; box-shadow: 0 2px 10px #0056cc22; max-width: 650px; margin: 3em auto 2em; }
    h1, h2 { color: #0056cc; font-weight: bold; }
    #status { color: #c00; font-weight: bold; margin-bottom: 1em; }
    #answersList { text-align: left; }
    input[type="text"] { padding: 0.5em; font-size: 1.1em; border-radius: 5px; border: 1px solid #bbb; margin: 0.7em 1em 0.7em 0; width: 7em; }
    button { background: #0056cc; color: #fff; border: none; border-radius: 1em; padding: 0.7em 1.7em; font-size: 1.1em; margin: 0.7em 0.7em 0 0; cursor: pointer; }
    button:disabled { background: #aaa; }
    #globalComment { width: 98%; min-height: 40px; font-size: 1.05em; padding: 0.5em; border-radius: 0.6em; border: 1px solid #bbb; margin-top: 0.7em; }
    #pauseBtn, #resumeBtn { background: #fb8c00; color: #fff; }
    @media (max-width: 700px) {
      #main, #questionnaire, #summary { padding: 0.7em; }
      button { padding: 0.5em 1em; font-size: 1em; }
    }
    .partTitle { font-size:1.22em; font-weight: bold; color:#337; margin-top:1.7em; }
    #zoneResponse { margin-top: 1.7em; }
    #zoneResponse input[type="text"] { width: 60%; min-width: 100px; }
    #zoneResponse button { padding: 0.6em 1.4em; }
    #introText {
      background: #eaf2ff;
      border-left: 5px solid #0056cc;
      padding: 1em;
      margin-bottom: 1em;
      font-size: 1.13em;
      color: #222;
    }
    #langAdvice {
      color: #c90;
      font-size: 0.95em;
      margin-bottom: 1.4em;
      max-width: 600px;
      background: #fffbe8;
      border-left: 5px solid #fb8c00;
      padding: 0.7em 1em;
    }
    #voiceWarning {
      color: #b30000;
      background: #fff0f0;
      border-left: 6px solid #b30000;
      padding: 0.8em 1em;
      margin-bottom: 1em;
      font-size: 1.05em;
      display: none;
      font-weight: bold;
      max-width: 650px;
    }
    #mainStart {
      text-align:center; margin:2em 0;
    }
    #btnCommencer {
      font-size:1.3em; padding:1em 3em; border-radius:1.6em; margin-top:1.6em;
      box-shadow: 0 2px 10px #0056cc22;
    }
  </style>
</head>
<body>
 <div id="voiceWarning"></div>
  <div id="main">
    <h1>Questionnaire DSM-5 (Vocal)</h1>
    <div id="mainStart">
      <button id="btnCommencer">Commencer</button>
      <div id="chromeAdvice" style="color:#888;font-size:0.98em;max-width:500px;margin:0.7em auto 0 auto;">
        ‚ö†Ô∏è Sur Chrome, la voix peut ne pas d√©marrer lors de l‚Äôintroduction, mais fonctionnera ensuite pour chaque question.
      </div>
    </div>
    <div id="intro" style="display:none;">
      <p id="introText"></p>
      <p id="langAdvice">
        Pour une exp√©rience optimale‚ÄØ: <b>utilisez Google Chrome</b> sur ordinateur ou Android.<br>
        Si la voix n‚Äôest pas en fran√ßais ou si le micro ne fonctionne pas, v√©rifiez les param√®tres de langue de votre navigateur et de votre appareil.<br>
        La reconnaissance vocale n‚Äôest pas toujours disponible sur Safari (iPhone/iPad) ou Firefox.
      </p>
      <p>
        <label for="codeInput"><b>Entrez un code de 4 chiffres (au choix)‚ÄØ:</b></label><br>
        <input type="text" id="codeInput" maxlength="4" pattern="[0-9]{4}" autocomplete="off" />
      </p>
      <button id="startBtn">D√©marrer le questionnaire</button>
      <div id="status"></div>
    </div>
  </div> 

  <div id="questionnaire" style="display:none;">
    <div id="partLabel" style="font-size:1.13em;color:#0056cc;margin-bottom:1em;"></div>
    <p id="question"></p>
    <button id="pauseBtn">Pause</button>
    <button id="resumeBtn" style="display:none;">Reprendre</button>
  </div>
  <div id="summary" style="display:none;">
    <h2>Merci‚ÄØ!</h2>
    <p>Voici vos r√©ponses :</p>
    <ul id="answersList"></ul>
    <label for="globalComment">Commentaire global (optionnel)‚ÄØ:</label>
    <textarea id="globalComment" placeholder="Vous pouvez ici ajouter tout commentaire libre..."></textarea>
    <br>
    <button id="copyBtn">Copier les r√©ponses</button>
    <button id="pdfBtn">Exporter en PDF</button>
    <p style="font-size:0.97em; color:#666; margin-top:2em;">Pour transmettre √† votre professionnel, copiez vos r√©ponses ou exportez en PDF puis envoyez-les par mail.</p>
  </div>
  <script>
    // Force le navigateur √† charger les voix synth√©tiques (pour Chrome)
    window.speechSynthesis.getVoices();

    const introTexte = `Je vais vous poser plusieurs questions portant sur les derni√®res semaines. 
Commencez par entrer un code de 4 chiffres que vous choisissez √† votre guise. 
Ces questions sont group√©es en 23 sections‚ÄØ: prenez votre temps, r√©pondez calmement, 
vous pouvez commenter et faire une pause. S'il y a erreur, utilisez le micro ou √©crivez votre r√©ponse. 
√Ä la fin, un commentaire global est possible et vous pourrez copier vos r√©ponses 
ou les enregistrer en PDF gr√¢ce aux boutons pr√©vus √† cet effet.`;

    // -------------------- QUESTIONS DSM-5 --------------------
    const questions = [
      // Section 1 : Informations personnelles
      { section: 1, text: "Quel est votre √¢ge ?" },
      { text: "Quel est votre sexe ?" },
      { text: "Quel est votre profession ?" },
      // Section 2 : Ant√©c√©dents m√©dicaux
      { section: 2, text: "Y a-t-il des ant√©c√©dents m√©dicaux connus ? Si oui, veuillez pr√©ciser." },
      { text: "Des traitements m√©dicamenteux sont-ils actuellement suivis ? Si oui, veuillez indiquer lesquels, y compris les m√©dicaments sans ordonnance et les compl√©ments alimentaires." },
      // Section 3 : Sympt√¥mes d‚Äôanxi√©t√©
      { section: 3, text: "Ressentez-vous de la nervosit√©, de l‚Äôanxi√©t√© ou une tension excessive ?" },
      { text: "Avez-vous tendance √† vous inqui√©ter excessivement pour diverses choses, ou √† ne pas pouvoir contr√¥ler vos inqui√©tudes ?" },
      { text: "Avez-vous des difficult√©s √† vous concentrer, par exemple en lisant ou en regardant la t√©l√©vision ?" },
      { text: "Vous sentez-vous agit√©(e), avez-vous du mal √† rester assis(e) tranquillement ?" },
      { text: "Observez-vous des troubles de l‚Äôapp√©tit, tels qu‚Äôune perte ou une augmentation de l‚Äôapp√©tit ?" },
      { text: "Ressentez-vous un sentiment d‚Äô√©chec ou d‚Äôavoir d√©√ßu vous-m√™me ou votre entourage ?" },
      // Section 4 : Sympt√¥mes d√©pressifs
      { section: 4, text: "Manquez-vous d‚Äôint√©r√™t ou de plaisir √† faire des choses qui vous plaisaient auparavant ?" },
      { text: "Ressentez-vous une humeur d√©pressive, une tristesse ou un sentiment de d√©sespoir ?" },
      { text: "Vous sentez-vous fatigu√©(e) ou avez-vous un manque d‚Äô√©nergie ?" },
      // Section 5 : Sympt√¥mes obsessionnels-compulsifs (TOC)
      { section: 5, text: "R√©p√©tez-vous certains gestes, comme vous laver les mains, compter, v√©rifier ou organiser des objets ? (Si non, passez √† la section suivante)" },
      { text: "Ces comportements sont-ils effectu√©s en r√©ponse √† une pens√©e obsessionnelle ou une peur ?" },
      { text: "Ces pens√©es ou comportements occupent-ils plus d‚Äôune heure par jour ou perturbent-ils significativement votre vie quotidienne ?" },
      // Section 6 : Irritabilit√© et col√®re
      { section: 6, text: "√ätes-vous facilement irritable ou en col√®re ?" },
      { text: "Estimez-vous que vos acc√®s de col√®re sont disproportionn√©s par rapport √† la situation ?" },
      // Section 7 : Sympt√¥mes maniaques
      { section: 7, text: "Traversez-vous des p√©riodes o√π vous vous sentez particuli√®rement √©nergique, euphorique ou surexcit√©(e) ?" },
      { text: "Lors de ces p√©riodes, avez-vous tendance √† entreprendre des activit√©s qui pourraient avoir des cons√©quences n√©gatives ?" },
      // Section 8 : Sympt√¥mes dissociatifs
      { section: 8, text: "Vous arrive-t-il de vous sentir d√©tach√©(e) de vous-m√™me ou de votre environnement ?" },
      { text: "Avez-vous d√©j√† ressenti une impression d‚Äôirr√©alit√© √† propos de votre environnement ?" },
      // Section 9 : Troubles de la m√©moire
      { section: 9, text: "Rencontrez-vous des difficult√©s de m√©moire, comme oublier des informations ou perdre le sens de l‚Äôorientation (par exemple, retrouver votre chemin) ?" },
      // Section 10 : Fonctionnement social et professionnel
      { section: 10, text: "Dans quelle mesure ces difficult√©s ont-elles affect√© votre capacit√© √† travailler, √† vous occuper de votre domicile ou √† entretenir des relations avec autrui ?" },
      { text: "√Ä quel point estimez-vous que votre situation de vie actuelle et vos relations sociales vous apportent du soutien ?" },
      // Section 11 : Usage de substances
      { section: 11, text: "Utilisez-vous du tabac, de l‚Äôalcool, des drogues ou de la caf√©ine ? Si oui, veuillez indiquer la fr√©quence et la quantit√©." },
      // Section 12 : Sympt√¥mes somatiques
      { section: 12, text: "Ressentez-vous des douleurs chroniques ou un inconfort physique ? Si oui, merci de pr√©ciser." },
      { text: "Y a-t-il d‚Äôautres sympt√¥mes physiques que vous avez remarqu√©s et qui vous pr√©occupent ?" },
      { text: "Comment √©valueriez-vous votre √©tat de sant√© physique global (mauvais, passable, bon, tr√®s bon, excellent) ?" },
      // Section 13 : Id√©es suicidaires
      { section: 13, text: "Avez-vous eu des pens√©es selon lesquelles il vaudrait mieux √™tre mort(e) ou vous blesser d‚Äôune quelconque mani√®re ?" },
      // Section 14 : Qualit√© du sommeil
      { section: 14, text: "Comment √©valueriez-vous la qualit√© g√©n√©rale de votre sommeil ?" },
      { text: "√âprouvez-vous des difficult√©s √† vous endormir ou √† rester endormi(e) durant la nuit ?" },
      { text: "Vous r√©veillez-vous le matin en vous sentant repos√©(e) ou encore fatigu√©(e) ?" },
      { text: "Avez-vous des troubles du sommeil, tels que des cauchemars, du somnambulisme ou des r√©veils fr√©quents ?" },
      { text: "Utilisez-vous des m√©dicaments ou des substances pour faciliter le sommeil ?" },
      { text: "Des changements de mode de vie ou des √©v√©nements r√©cents ont-ils modifi√© votre rythme de sommeil ?" },
      // Section 15 : Mode de vie
      { section: 15, text: "√Ä quelle fr√©quence pratiquez-vous une activit√© physique ou de l‚Äôexercice ?" },
      // Section 16 : Ant√©c√©dents de sant√© mentale
      { section: 16, text: "Un diagnostic de trouble psychique a-t-il d√©j√† √©t√© pos√© auparavant ?" },
      { text: "Un traitement pour des difficult√©s psychiques a-t-il d√©j√† √©t√© suivi (th√©rapie, conseil, m√©dication) ? Si oui, merci de pr√©ciser." },
      // Section 17 : Attentes et objectifs de la consultation
      { section: 17, text: "Y a-t-il un sujet sp√©cifique que vous souhaitez aborder lors de la consultation ?" },
      { text: "Quels sont vos objectifs ou attentes en consultant actuellement ?" },
      // Section 18 : Sympt√¥mes psychotiques
      { section: 18, text: "Avez-vous per√ßu des voix que les autres ne semblent pas entendre ?" },
      { text: "Avez-vous eu des croyances ou des id√©es que d‚Äôautres personnes consid√®rent comme √©tranges ou inhabituelles ?" },
      // Section 19 : Sympt√¥mes alimentaires
      { section: 19, text: "Vous arrive-t-il de vous inqui√©ter de fa√ßon excessive pour votre poids ou votre apparence corporelle ?" },
      { text: "Avez-vous eu des √©pisodes de restriction alimentaire importante, de vomissements volontaires, ou de prises alimentaires excessives et incontr√¥lables ?" },
      // Section 20 : Sympt√¥mes sexuels
      { section: 20, text: "Avez-vous constat√© une baisse notable de votre int√©r√™t ou de votre satisfaction concernant votre sexualit√© ?" },
      // Section 21 : Sympt√¥mes de stress post-traumatique
      { section: 21, text: "Avez-vous √©t√© expos√©(e) √† un √©v√©nement traumatique qui continue √† vous perturber (cauchemars, flashbacks, √©vitement) ?" },
      { text: "Pr√©sentez-vous des r√©actions de stress importantes en lien avec des souvenirs douloureux ?" },
      // Section 22 : Sympt√¥mes d‚Äôinattention/hyperactivit√©
      { section: 22, text: "Rencontrez-vous souvent des difficult√©s √† rester concentr√©(e), √† terminer ce que vous commencez, ou √† rester en place ?" },
      { text: "√ätes-vous fr√©quemment distrait(e) ou ressentez-vous une agitation int√©rieure ou physique inhabituelle ?" },
      // Section 23 : S√©curit√© et abus
      { section: 23, text: "Avez-vous √©t√© expos√©(e) √† des situations de violence ou de maltraitance ? Si oui, souhaitez-vous en parler ?" }
    ];

    let responses = [];
    let current = 0;
    let codePerso = "";
    let isPaused = false;
    let autoNextTimeout = null;
    let speechRecognitionActive = false;
    let speechRecognitionInstance = null;
    let frenchVoice = null;

    const mainDiv = document.getElementById("main");
    const introText = document.getElementById("introText");
    const codeInput = document.getElementById("codeInput");
    const startBtn = document.getElementById("startBtn");
    const questionnaireDiv = document.getElementById("questionnaire");
    const partLabel = document.getElementById("partLabel");
    const questionEl = document.getElementById("question");
    const pauseBtn = document.getElementById("pauseBtn");
    const resumeBtn = document.getElementById("resumeBtn");
    const summaryDiv = document.getElementById("summary");
    const answersList = document.getElementById("answersList");
    const copyBtn = document.getElementById("copyBtn");
    const pdfBtn = document.getElementById("pdfBtn");
    const statusDiv = document.getElementById("status");
    const commentGlobal = document.getElementById("globalComment");
    const voiceWarning = document.getElementById("voiceWarning");

    // --- [V√©rifie la disponibilit√© de la reconnaissance vocale dans le navigateur] ---
    function checkSpeechRecognitionSupport() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        statusDiv.innerHTML = "<span style='color:#c00'>La reconnaissance vocale (microphone) n'est pas disponible sur ce navigateur.<br>Utilisez Google Chrome sur ordinateur ou Android pour activer la saisie vocale.<br>Sur iPhone/iPad (Safari) ou Firefox, cette fonction est d√©sactiv√©e.</span>";
        return false;
      }
      return true;
    }

    // --- [Affiche l'alerte si aucune voix FR n'est d√©tect√©e] ---
    window.speechSynthesis.onvoiceschanged = function() {
      const voices = window.speechSynthesis.getVoices();
      frenchVoice = voices.find(v => v.lang.startsWith("fr") || v.lang === "fr-FR");
      if (!frenchVoice) {
        voiceWarning.style.display = "block";
        voiceWarning.innerHTML = "‚ö†Ô∏è Aucune voix fran√ßaise d√©tect√©e sur ce syst√®me. <br>La synth√®se vocale risque d‚Äô√™tre en anglais ou avec un accent √©tranger.<br>Pour corriger : installez une voix fran√ßaise dans les param√®tres de votre syst√®me ou navigateur.<br>Utilisez de pr√©f√©rence Chrome sous Windows, Mac ou Android.";
      } else {
        voiceWarning.style.display = "none";
      }
    };

    // --- [Lecture vocale d'un texte, si possible en fran√ßais] ---
    function speak(txt, onendCallback) {
      if (!window.speechSynthesis) return;
      window.speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(txt);
      utter.lang = "fr-FR";
      if (frenchVoice) utter.voice = frenchVoice;
      if (typeof onendCallback === "function") {
        utter.onend = onendCallback;
      }
      window.speechSynthesis.speak(utter);
    }

    // --- [Lance la reconnaissance vocale pour une r√©ponse √† une question] ---
    function startRecognition(callback) {
      if (!checkSpeechRecognitionSupport()) {
        callback("");
        return;
      }
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = "fr-FR";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();
      speechRecognitionActive = true;
      recognition.onresult = function(event) {
        speechRecognitionActive = false;
        const transcript = event.results[0][0].transcript.trim();
        callback(transcript);
      };
      recognition.onerror = function(event) {
        speechRecognitionActive = false;
        if (event.error === "no-speech" || event.error === "aborted") {
          callback("");
        } else {
          alert("Erreur vocale‚ÄØ: " + event.error + "\nVous pouvez r√©pondre par √©crit ou relancer le micro.");
          callback("");
        }
      };
      speechRecognitionInstance = recognition;
    }

    // --- [Affiche une question √† l'utilisateur, g√®re r√©ponse manuelle ou vocale] ---
    function askQuestion(idx) {
      if (typeof questions[idx].section === "number") {
        partLabel.textContent = "Section " + questions[idx].section;
      } else {
        partLabel.textContent = "";
      }
      questionEl.innerHTML = questions[idx].text;

      let responseZone = document.createElement("div");
      responseZone.style.marginTop = "1.3em";

      let input = document.createElement("input");
      input.type = "text";
      input.id = "inputResponse";
      input.style.padding = "0.5em";
      input.style.width = "70%";
      input.placeholder = "R√©pondez ici √† la main ou utilisez le micro...";
      responseZone.appendChild(input);

      if (responses[idx]) input.value = responses[idx];

      let btnVocal = document.createElement("button");
      btnVocal.textContent = "üé§ R√©pondre √† voix haute";
      btnVocal.style.marginLeft = "1em";
      responseZone.appendChild(btnVocal);

      let btnValider = document.createElement("button");
      btnValider.textContent = "Valider";
      btnValider.style.marginLeft = "1em";
      responseZone.appendChild(btnValider);

      let correctionZone = document.createElement("div");
      correctionZone.style.marginTop = "0.7em";
      responseZone.appendChild(correctionZone);

      input.addEventListener("keydown", function(e){
        if (e.key === "Enter") {
          responses[idx] = input.value.trim();
          nextQuestionOrSummary();
        }
      });

      btnValider.onclick = function() {
        responses[idx] = input.value.trim();
        nextQuestionOrSummary();
      };

      let oldZone = document.getElementById("zoneResponse");
      if (oldZone) oldZone.remove();
      responseZone.id = "zoneResponse";
      questionEl.parentNode.appendChild(responseZone);

      input.focus();
      speak(questions[idx].text);

      // --- [Reconnaissance vocale automatique, correction et auto-next] ---
      function autoRecognition() {
        btnVocal.disabled = true;
        startRecognition(function(rep) {
          btnVocal.disabled = false;
          input.value = rep || "";
          if (rep && rep.trim()) {
            showCorrectionBtns(rep);
          }
        });
      }

      // --- [Affiche boutons de correction apr√®s reco vocale, auto-next si pas de correction] ---
      function showCorrectionBtns(rep) {
        correctionZone.innerHTML = '';
        let btnOk = document.createElement("button");
        btnOk.textContent = "C'est correct";
        btnOk.style.background = "#2bca2b";
        btnOk.style.marginRight = "1em";
        let btnRetry = document.createElement("button");
        btnRetry.textContent = "Corriger";
        btnRetry.style.background = "#fb8c00";
        correctionZone.appendChild(btnOk);
        correctionZone.appendChild(btnRetry);

        // --- [Auto passage √† la question suivante apr√®s 3 secondes si aucune correction] ---
        // Pour ajuster le d√©lai, modifie la valeur (ici 3000 ms = 3 secondes)
        autoNextTimeout = setTimeout(function(){
          if (input.value === rep) {
            responses[idx] = input.value.trim();
            nextQuestionOrSummary();
          }
        }, 3000);

        btnOk.onclick = function() {
          if (autoNextTimeout) clearTimeout(autoNextTimeout);
          responses[idx] = input.value.trim();
          nextQuestionOrSummary();
        };
        btnRetry.onclick = function() {
          if (autoNextTimeout) clearTimeout(autoNextTimeout);
          input.value = "";
          correctionZone.innerHTML = "";
          setTimeout(autoRecognition, 500);
        };
      }

      setTimeout(() => { autoRecognition(); }, 1000);

      btnVocal.onclick = function() {
        input.value = "";
        correctionZone.innerHTML = "";
        autoRecognition();
      };
    }

    // --- [Passe √† la question suivante, ou affiche le r√©sum√© final] ---
    function nextQuestionOrSummary() {
      if (autoNextTimeout) clearTimeout(autoNextTimeout);
      current++;
      if (current < questions.length) askQuestion(current);
      else showSummary();
    }

    // --- [Affiche le r√©sum√© final des r√©ponses avec possibilit√© de correction] ---
    function showSummary() {
      questionnaireDiv.style.display = "none";
      summaryDiv.style.display = "block";
      answersList.innerHTML = "";
      questions.forEach((q, i) => {
        const li = document.createElement("li");
        li.innerHTML = `<b>Section ${q.section || ""}</b> ‚Äî ${q.text} : <span id="rep${i}">${responses[i] || ""}</span> `;
        let btnCorriger = document.createElement("button");
        btnCorriger.textContent = "Corriger";
        btnCorriger.style.marginLeft = "1em";
        btnCorriger.onclick = function() {
          summaryDiv.style.display = "none";
          questionnaireDiv.style.display = "block";
          current = i;
          askQuestion(i);
        };
        li.appendChild(btnCorriger);
        answersList.appendChild(li);
      });
    }

    // --- [Bouton D√©marrer le questionnaire] ---
    startBtn.onclick = function() {
      const code = codeInput.value.trim();
      if (!/^\d{4}$/.test(code)) {
        statusDiv.textContent = "Merci de saisir un code de 4 chiffres.";
        return;
      }
      codePerso = code;
      mainDiv.style.display = "none";
      questionnaireDiv.style.display = "block";
      current = 0;
      responses = [];
      resumeBtn.style.display = "none";
      pauseBtn.style.display = "inline";
      isPaused = false;
      askQuestion(current);
    };

    // --- [Met le questionnaire en pause] ---
    pauseBtn.onclick = function() {
      isPaused = true;
      questionnaireDiv.style.opacity = 0.3;
      pauseBtn.style.display = "none";
      resumeBtn.style.display = "inline";
      speak("Pause activ√©e. Cliquez sur reprendre pour continuer.");
      if (speechRecognitionInstance) {
        try { speechRecognitionInstance.abort(); } catch(e){}
      }
    };

    // --- [Reprend le questionnaire apr√®s une pause] ---
    resumeBtn.onclick = function() {
      isPaused = false;
      questionnaireDiv.style.opacity = 1;
      pauseBtn.style.display = "inline";
      resumeBtn.style.display = "none";
      speak("Reprise du questionnaire.");
      askQuestion(current);
    };

    // --- [Copie les r√©ponses au presse-papier] ---
    copyBtn.onclick = function() {
      const txt = "Code‚ÄØ: " + codePerso + "\n"
        + questions.map((q, i) => "Section " + (q.section||"") + " ‚Äî " + q.text + " : " + (responses[i] || "")).join("\n")
        + "\nCommentaire global‚ÄØ: " + commentGlobal.value;
      navigator.clipboard.writeText(txt);
      alert("R√©ponses copi√©es‚ÄØ!");
    };

    // --- [Export PDF via impression] ---
    pdfBtn.onclick = function() {
      window.print();
    };

    // --- [Logique du bouton "Commencer" (d√©verrouille la voix d‚Äôintro)] ---
    window.onload = function() {
window.onload = function() {
  // V√©rifie si la reconnaissance vocale (micro) est disponible
  checkSpeechRecognitionSupport();

  // --- Au clic sur "Commencer" ---
  document.getElementById('btnCommencer').onclick = function() {
    // Cache le bouton "Commencer" et le message d'avertissement Chrome
    document.getElementById('btnCommencer').style.display = 'none';
// Ne bloque pas si chromeAdvice n'existe pas
  var chromeAdvice = document.getElementById('chromeAdvice');
  if (chromeAdvice) chromeAdvice.style.display = 'none';
    document.getElementById('chromeAdvice').style.display = 'none';

    // Affiche le texte d'introduction et la zone de saisie du code
    document.getElementById('introText').textContent = introTexte;
    document.getElementById('intro').style.display = "block";

    // --- IMPORTANT : D√©lai de 350ms pour laisser √† Chrome le temps d'activer la synth√®se vocale
    // (Sur Edge ou Firefox, ce d√©lai n'impacte rien)
    setTimeout(function() {
      // Lecture vocale de l'introduction
      speak(introTexte, function() {
        // Puis lecture vocale "Entrez vos 4 chiffres"
        speak("Entrez vos 4 chiffres.", function() {
          // Focus automatique sur le champ code apr√®s la voix
          document.getElementById('codeInput').focus();
        });
      });
    }, 350);
  };
};
  </script>
</body>
</html>
